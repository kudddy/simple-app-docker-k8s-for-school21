# Чуть чуть про разработку, k8s и openshift

## Вступление

Привет, сегодня я хочу рассказать про технологии виртуализации, k8s/ openshift. 
Часто кандидаты не знают базовых основ, так что цель этого мини туториала рассказать про основной концепции этих технологий. 

## Что такое docker и зачем он нужен?
Docker — это платформа, которая предназначена для разработки, развёртывания и запуска приложений в контейнерах. 

Какие плюсы использование docker?

`Изолированность` -  Вы не зависите от по, которое установлено на вашем железе. Конечно на нем должен установлен docker агент, но. 
Ваша программа требует для фрейворк который работает только с ubuntu? не проблема, 
берите ubuntu, либо может вам лень настаивать самому чистую ОС, где нет ни node js, ни python интерпретатора? 
не проблема? Берите уже готовый образ с предустановленным ПО из репозитория контейнеров

`Версионировние` -  Из этого пункта вытекает еще один плюст - это возможность версионировать ваше приложение. 
Например, у вас есть готовое приложение к которому вы подготовили какую нибудь полезную фичу. 
Вы вакатили новую версию и оказалось что новый функционал аффектит и требуется быстро вернуть старую версию обратно. 
Не проблема, просто возьмите старый контейнер и начните исрользовать его

`Легкость` -  Представьте, вы разрабатываете ПО, но окруженеи вашего железа отличавется от вашего, 
и в момент запустка вашего кода в другом окружении. Для отладки ваш важдый раз придется заливать ваш код на машину, 
что очень трудозатратно по времени. Docker решает эту проблему плюсом из пункта 1.

## Практическая часть. Как использовать?

### Быстрые команды
```
make devenv - Создать и установить тестововой окружение
make lin - Проверить код с помощью pylint
make postgres - Запустить контейнер с postgres
make test - запустить тесты
make docker - Собрать образ
make upload - Загрузить образ в хранилище
```

### Как запусить?
Собираем образ
```
make docker
```
Запускаем
```
docker run -p 8080:8080
```
Теперь приложение доступно на порту 8080.
### Как подготовить тестовое окружение?
```
make devenv
make postgres
source env/bin/activate
```
### Как запустить тесты?
```
make devenv
make postgres
source env/bin/activate
pytest
```
### Как запустить нагрузочное тестирование?
Для запуска locust необходимо выполнить следующие команды:
```
make devenv
source env/bin/activate
locust
```
теперь lokust доступен на локальном хосту. Перейдите по ссылке и можно начинать нагрузочное тестирование.
## K8s/OS
### Что это?
K8S - это открытое программное обеспечение для автоматизации развёртывания, 
масштабирования и управления контейнеризированными приложениями.

Как и docker k8s произвел настоящую революцию в области эксплуатации высыконагруженных систем
Какие плюсы дает платформа?


`Масштабируемость любого уровня` - Разработанный на тех же принципах, которые позволяют Google запускать миллиарды контейнеров в неделю, Kubernetes может масштабироваться без увеличения вашей технической команды.

`Бесконечная гибкость` - Будь то локальное тестирование или работа в корпорации, гибкость Kubernetes растёт вместе с вами, обеспечивая бесперебойную и простую доставку приложений, независимо от сложности ваших потребностей.

`Может быть запущен где угодно` - Kubernetes — это проект с открытым исходным кодом, который даёт вам полную свободу воспользоваться преимуществами локальной, гибридной или публичной облачной инфраструктуры, позволяя без усилий перераспределять рабочую нагрузку по мере необходимости.

Что такое OS?

OS - это k8s, но безопасней.

### Где найти самый доступный вариант?

Например, gcloud. Google Cloud предоставляет тестовую учетку с 300$, где можно крутить тестовые приложения.

### Тактика деплоя и основный команды
Я уже настроил кластер и он доступен с моей локальной машины.
Вообще если говорить про серьезную разработку, то данные шаги мы выполняем автоматически, этот процесс называется `CI/CD` конвеер.
На этапе `CI`, робот(если его правильно настоить), гоняет тесты, смотрит на процент покрытия кода, проверяет на уязвимости(checkmarx)... и
наконец собирает образ и отправляет в репозиторий контейнеров.
На этапе `CD` робот берет наш готовый и оттестированный образ с приложением и применеяем готовую конфигурацю к нашему кластеру k8s.

Пройдемся по шагам:

`kubectl apply -f backend-deployments.yaml` - данной командой мы применяем шаблон с деплойментом. кластер поднимает `pod` c контейнером внутри.
Теперь нам требуется сделать наше приложение внутри кластера.

`kubectl apply -f backend-service.yaml` - данной командой мы делаем это. Обрати внимание что поле type.С помощью этого поля мы можем сделать приложение доступным как внутри кластера, так и снаружи.

Допустим, мы сделали нашего приложение доступным всему интернету и вот им уже начинаю пользоваться.
Давайте посмотрим логи нашего прилоения? легко

`kubectl logs -f -l app=simplebackend` - k8s выведет вам все логи.

Что делать если вы хотите удалить приложение? досаточно удалить deployments и все копии приложения.

`kubectl delete deployments tlg-backend-deployment` -  удаление deployments и в следствии всех pod





